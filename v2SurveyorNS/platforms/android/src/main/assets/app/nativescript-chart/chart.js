"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var platform = require("platform");
var page;
var ele = [];
var maxEle;
var minEle;
var targetEle;
var prevIndex;
var smoothingRange; // when there is a data skip in the azimuth, we want to smooth it out linearly. This is the max range of the smoothing. Any jumps more than 20 will not be smoothed
var width = platform.screen.mainScreen.widthPixels / 360 / platform.screen.mainScreen.scale; // in dp
var maxHeight = platform.screen.mainScreen.heightPixels / 8 / platform.screen.mainScreen.scale; // in dp
function initGraph(myPage) {
    console.log("Entering initGraph");
    page = myPage;
    maxEle = 60;
    minEle = 0;
    targetEle = 40;
    smoothingRange = 20;
    page.getViewById("graph").height = maxHeight;
    var ltarget = page.getViewById("ltarget");
    ltarget.height = width;
    ltarget.translateY = -maxHeight * ele2Percent(targetEle);
    for (var i = 0; i < 360; i++) {
        ele.push((maxEle + minEle) / 2);
        page.getViewById("l" + i).height = maxHeight * ele2Percent(ele[i]);
    }
}
exports.initGraph = initGraph;
function updateGraph(azimuth, elevation) {
    var az = Math.floor(azimuth) + 180;
    ele[az] = -elevation < minEle ? minEle : -elevation > maxEle ? maxEle : -elevation;
    var currentView = page.getViewById("l" + az);
    currentView.height = maxHeight * ele2Percent(ele[az]);
    var dif = az - prevIndex;
    if (Math.abs(dif) > 1 && Math.abs(dif) < smoothingRange) {
        var start = void 0, end = void 0;
        if (dif > 0) {
            start = prevIndex + 1;
            end = az;
        }
        else {
            start = az + 1;
            end = prevIndex;
        }
        for (var i = start; i < end; i++) {
            ele[i] = ele[start - 1] + (i - start + 1) / (dif - 1) * (ele[az] - ele[prevIndex]);
            page.getViewById("l" + (i)).height = maxHeight * ele2Percent(ele[i]);
        }
    }
    prevIndex = az;
}
exports.updateGraph = updateGraph;
function ele2Percent(elevation) {
    return (elevation - minEle) / (maxEle - minEle);
}
function onExit() {
}
exports.onExit = onExit;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFxQztBQUlyQyxJQUFJLElBQUksQ0FBQztBQUNULElBQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQztBQUV6QixJQUFJLE1BQWMsQ0FBQztBQUNuQixJQUFJLE1BQWMsQ0FBQztBQUNuQixJQUFJLFNBQWlCLENBQUM7QUFDdEIsSUFBSSxTQUFpQixDQUFDO0FBQ3RCLElBQUksY0FBc0IsQ0FBQyxDQUFDLG1LQUFtSztBQUUvTCxJQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEdBQUcsR0FBRyxHQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVE7QUFDdEcsSUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRSxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRO0FBRXpHLG1CQUEwQixNQUFNO0lBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUNsQyxJQUFJLEdBQUcsTUFBTSxDQUFDO0lBQ2QsTUFBTSxHQUFHLEVBQUUsQ0FBQztJQUNaLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDWCxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ2YsY0FBYyxHQUFHLEVBQUUsQ0FBQztJQUNwQixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7SUFDN0MsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM1QyxPQUFPLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztJQUN2QixPQUFPLENBQUMsVUFBVSxHQUFHLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUV6RCxHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzVCLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUUsTUFBTSxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEdBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkUsQ0FBQztBQUNILENBQUM7QUFoQkQsOEJBZ0JDO0FBRUQscUJBQTRCLE9BQU8sRUFBRSxTQUFTO0lBQzVDLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ3JDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBQyxNQUFNLEdBQUUsTUFBTSxHQUFFLENBQUMsU0FBUyxHQUFDLE1BQU0sR0FBRSxNQUFNLEdBQUUsQ0FBQyxTQUFTLENBQUM7SUFFM0UsSUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEdBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsV0FBVyxDQUFDLE1BQU0sR0FBRyxTQUFTLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRXRELElBQU0sR0FBRyxHQUFHLEVBQUUsR0FBQyxTQUFTLENBQUM7SUFDekIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDO1FBQ3ZELElBQUksS0FBSyxTQUFBLEVBQUUsR0FBRyxTQUFBLENBQUM7UUFDZixFQUFFLENBQUEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNYLEtBQUssR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDWCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixLQUFLLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNmLEdBQUcsR0FBRyxTQUFTLENBQUM7UUFDbEIsQ0FBQztRQUNELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDakMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQzNFLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRSxDQUFDO0lBQ0gsQ0FBQztJQUNELFNBQVMsR0FBRyxFQUFFLENBQUM7QUFDakIsQ0FBQztBQXZCRCxrQ0F1QkM7QUFFRCxxQkFBcUIsU0FBUztJQUM1QixNQUFNLENBQUMsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLEdBQUMsQ0FBQyxNQUFNLEdBQUMsTUFBTSxDQUFDLENBQUM7QUFDOUMsQ0FBQztBQUVEO0FBQ0EsQ0FBQztBQURELHdCQUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGxhdGZvcm0gZnJvbSBcInBsYXRmb3JtXCI7XHJcbmltcG9ydCAqIGFzIGtub3duQ29sb3JzIGZyb20gXCJjb2xvci9rbm93bi1jb2xvcnNcIjtcclxuaW1wb3J0ICogYXMgSW1hZ2VNb2R1bGUgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvaW1hZ2VcIjtcclxuXHJcbmxldCBwYWdlO1xyXG5jb25zdCBlbGU6IG51bWJlcltdID0gW107XHJcblxyXG5sZXQgbWF4RWxlOiBudW1iZXI7XHJcbmxldCBtaW5FbGU6IG51bWJlcjtcclxubGV0IHRhcmdldEVsZTogbnVtYmVyO1xyXG5sZXQgcHJldkluZGV4OiBudW1iZXI7XHJcbmxldCBzbW9vdGhpbmdSYW5nZTogbnVtYmVyOyAvLyB3aGVuIHRoZXJlIGlzIGEgZGF0YSBza2lwIGluIHRoZSBhemltdXRoLCB3ZSB3YW50IHRvIHNtb290aCBpdCBvdXQgbGluZWFybHkuIFRoaXMgaXMgdGhlIG1heCByYW5nZSBvZiB0aGUgc21vb3RoaW5nLiBBbnkganVtcHMgbW9yZSB0aGFuIDIwIHdpbGwgbm90IGJlIHNtb290aGVkXHJcblxyXG5jb25zdCB3aWR0aCA9IHBsYXRmb3JtLnNjcmVlbi5tYWluU2NyZWVuLndpZHRoUGl4ZWxzIC8gMzYwIC9wbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi5zY2FsZTsgLy8gaW4gZHBcclxuY29uc3QgbWF4SGVpZ2h0ID0gcGxhdGZvcm0uc2NyZWVuLm1haW5TY3JlZW4uaGVpZ2h0UGl4ZWxzIC8gOCAvcGxhdGZvcm0uc2NyZWVuLm1haW5TY3JlZW4uc2NhbGU7IC8vIGluIGRwXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW5pdEdyYXBoKG15UGFnZSkge1xyXG4gIGNvbnNvbGUubG9nKFwiRW50ZXJpbmcgaW5pdEdyYXBoXCIpO1xyXG4gIHBhZ2UgPSBteVBhZ2U7XHJcbiAgbWF4RWxlID0gNjA7XHJcbiAgbWluRWxlID0gMDtcclxuICB0YXJnZXRFbGUgPSA0MDtcclxuICBzbW9vdGhpbmdSYW5nZSA9IDIwO1xyXG4gIHBhZ2UuZ2V0Vmlld0J5SWQoXCJncmFwaFwiKS5oZWlnaHQgPSBtYXhIZWlnaHQ7XG4gIGNvbnN0IGx0YXJnZXQgPSBwYWdlLmdldFZpZXdCeUlkKFwibHRhcmdldFwiKTtcclxuICBsdGFyZ2V0LmhlaWdodCA9IHdpZHRoO1xyXG4gIGx0YXJnZXQudHJhbnNsYXRlWSA9IC1tYXhIZWlnaHQgKiBlbGUyUGVyY2VudCh0YXJnZXRFbGUpO1xyXG5cclxuICBmb3IobGV0IGkgPSAwOyBpIDwgMzYwOyBpKyspIHtcclxuICAgIGVsZS5wdXNoKChtYXhFbGUrIG1pbkVsZSkvMik7XHJcbiAgICBwYWdlLmdldFZpZXdCeUlkKFwibFwiK2kpLmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVtpXSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlR3JhcGgoYXppbXV0aCwgZWxldmF0aW9uKSB7XHJcbiAgY29uc3QgYXogPSBNYXRoLmZsb29yKGF6aW11dGgpICsgMTgwO1xyXG4gIGVsZVthel0gPSAtZWxldmF0aW9uPG1pbkVsZT8gbWluRWxlOiAtZWxldmF0aW9uPm1heEVsZT8gbWF4RWxlOiAtZWxldmF0aW9uO1xyXG5cclxuICBjb25zdCBjdXJyZW50VmlldyA9IHBhZ2UuZ2V0Vmlld0J5SWQoXCJsXCIrYXopO1xyXG4gIGN1cnJlbnRWaWV3LmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVthel0pO1xyXG5cclxuICBjb25zdCBkaWYgPSBhei1wcmV2SW5kZXg7XHJcbiAgaWYoTWF0aC5hYnMoZGlmKSA+IDEgJiYgTWF0aC5hYnMoZGlmKSA8IHNtb290aGluZ1JhbmdlKSB7XHJcbiAgICBsZXQgc3RhcnQsIGVuZDtcclxuICAgIGlmKGRpZiA+IDApIHtcclxuICAgICAgc3RhcnQgPSBwcmV2SW5kZXggKyAxO1xyXG4gICAgICBlbmQgPSBhejtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHN0YXJ0ID0gYXogKyAxO1xyXG4gICAgICBlbmQgPSBwcmV2SW5kZXg7XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xyXG4gICAgICBlbGVbaV0gPSBlbGVbc3RhcnQtMV0gKyAoaSAtIHN0YXJ0KzEpIC8gKGRpZi0xKSAqIChlbGVbYXpdLWVsZVtwcmV2SW5kZXhdKTtcclxuICAgICAgcGFnZS5nZXRWaWV3QnlJZChcImxcIisoaSkpLmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVtpXSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByZXZJbmRleCA9IGF6O1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbGUyUGVyY2VudChlbGV2YXRpb24pIHtcclxuICByZXR1cm4gKGVsZXZhdGlvbiAtIG1pbkVsZSkvKG1heEVsZS1taW5FbGUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb25FeGl0KCkge1xyXG59XHJcbiJdfQ==