"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var platform = require("platform");
var layout = require("ui/layouts/grid-layout");
var page;
var ele = [];
var maxEle;
var minEle;
var targetEle;
var prevIndex;
var smoothingRange; // when there is a data skip in the azimuth, we want to smooth it out linearly. This is the max range of the smoothing. Any jumps more than 20 will not be smoothed
var width = platform.screen.mainScreen.widthPixels / 360 / platform.screen.mainScreen.scale; // in dp
var maxHeight = platform.screen.mainScreen.heightPixels / 8 / platform.screen.mainScreen.scale; // in dp
function initGraph(myPage) {
    console.log("Entering initGraph");
    page = myPage;
    maxEle = 60;
    minEle = 0;
    targetEle = 40;
    smoothingRange = 20;
    page.getViewById("graph").height = maxHeight;
    var ltarget = page.getViewById("ltarget");
    ltarget.height = width;
    ltarget.translateY = -maxHeight * ele2Percent(targetEle);
    for (var i = 0; i < 360; i++) {
        ele.push((maxEle + minEle) / 2);
        page.getViewById("l" + i).height = maxHeight * ele2Percent(ele[i]);
    }
}
exports.initGraph = initGraph;
function updateGraph(azimuth, elevation, isOn) {
    var az = Math.floor(azimuth) + 180;
    layout.GridLayout.setColumn(page.getViewById("lcursor"), az);
    if (isOn) {
        ele[az] = -elevation < minEle ? minEle : -elevation > maxEle ? maxEle : -elevation;
        var currentView = page.getViewById("l" + az);
        currentView.height = maxHeight * ele2Percent(ele[az]);
        var dif = az - prevIndex;
        if (Math.abs(dif) > 1 && Math.abs(dif) < smoothingRange) {
            var start = void 0, end = void 0;
            if (dif > 0) {
                start = prevIndex + 1;
                end = az;
            }
            else {
                start = az + 1;
                end = prevIndex;
            }
            for (var i = start; i < end; i++) {
                ele[i] = ele[start - 1] + (i - start + 1) / (dif - 1) * (ele[az] - ele[prevIndex]);
                page.getViewById("l" + (i)).height = maxHeight * ele2Percent(ele[i]);
            }
        }
        prevIndex = az;
    }
}
exports.updateGraph = updateGraph;
function ele2Percent(elevation) {
    return (elevation - minEle) / (maxEle - minEle);
}
function onExit() {
}
exports.onExit = onExit;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFxQztBQUdyQywrQ0FBaUQ7QUFFakQsSUFBSSxJQUFJLENBQUM7QUFDVCxJQUFNLEdBQUcsR0FBYSxFQUFFLENBQUM7QUFFekIsSUFBSSxNQUFjLENBQUM7QUFDbkIsSUFBSSxNQUFjLENBQUM7QUFDbkIsSUFBSSxTQUFpQixDQUFDO0FBQ3RCLElBQUksU0FBaUIsQ0FBQztBQUN0QixJQUFJLGNBQXNCLENBQUMsQ0FBQyxtS0FBbUs7QUFFL0wsSUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLEdBQUcsR0FBRSxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRO0FBQ3RHLElBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFlBQVksR0FBRyxDQUFDLEdBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUTtBQUV6RyxtQkFBMEIsTUFBTTtJQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDbEMsSUFBSSxHQUFHLE1BQU0sQ0FBQztJQUNkLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDWixNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ1gsU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNmLGNBQWMsR0FBRyxFQUFFLENBQUM7SUFDcEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO0lBQzdDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDNUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDdkIsT0FBTyxDQUFDLFVBQVUsR0FBRyxD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QUFNLEdBQUMsTUFBTSxDQUFDLENBQUM7QUFDOUMsQ0FBQztBQUVEO0FBQ0EsQ0FBQztBQURELHdCQUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGxhdGZvcm0gZnJvbSBcInBsYXRmb3JtXCI7XHJcbmltcG9ydCAqIGFzIGtub3duQ29sb3JzIGZyb20gXCJjb2xvci9rbm93bi1jb2xvcnNcIjtcclxuaW1wb3J0ICogYXMgSW1hZ2VNb2R1bGUgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvaW1hZ2VcIjtcclxuaW1wb3J0ICogYXMgbGF5b3V0IGZyb20gXCJ1aS9sYXlvdXRzL2dyaWQtbGF5b3V0XCI7XHJcblxyXG5sZXQgcGFnZTtcclxuY29uc3QgZWxlOiBudW1iZXJbXSA9IFtdO1xyXG5cclxubGV0IG1heEVsZTogbnVtYmVyO1xyXG5sZXQgbWluRWxlOiBudW1iZXI7XHJcbmxldCB0YXJnZXRFbGU6IG51bWJlcjtcclxubGV0IHByZXZJbmRleDogbnVtYmVyO1xyXG5sZXQgc21vb3RoaW5nUmFuZ2U6IG51bWJlcjsgLy8gd2hlbiB0aGVyZSBpcyBhIGRhdGEgc2tpcCBpbiB0aGUgYXppbXV0aCwgd2Ugd2FudCB0byBzbW9vdGggaXQgb3V0IGxpbmVhcmx5LiBUaGlzIGlzIHRoZSBtYXggcmFuZ2Ugb2YgdGhlIHNtb290aGluZy4gQW55IGp1bXBzIG1vcmUgdGhhbiAyMCB3aWxsIG5vdCBiZSBzbW9vdGhlZFxyXG5cclxuY29uc3Qgd2lkdGggPSBwbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi53aWR0aFBpeGVscyAvIDM2MCAvcGxhdGZvcm0uc2NyZWVuLm1haW5TY3JlZW4uc2NhbGU7IC8vIGluIGRwXHJcbmNvbnN0IG1heEhlaWdodCA9IHBsYXRmb3JtLnNjcmVlbi5tYWluU2NyZWVuLmhlaWdodFBpeGVscyAvIDggL3BsYXRmb3JtLnNjcmVlbi5tYWluU2NyZWVuLnNjYWxlOyAvLyBpbiBkcFxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluaXRHcmFwaChteVBhZ2UpIHtcclxuICBjb25zb2xlLmxvZyhcIkVudGVyaW5nIGluaXRHcmFwaFwiKTtcclxuICBwYWdlID0gbXlQYWdlO1xyXG4gIG1heEVsZSA9IDYwO1xyXG4gIG1pbkVsZSA9IDA7XHJcbiAgdGFyZ2V0RWxlID0gNDA7XHJcbiAgc21vb3RoaW5nUmFuZ2UgPSAyMDtcclxuICBwYWdlLmdldFZpZXdCeUlkKFwiZ3JhcGhcIikuaGVpZ2h0ID0gbWF4SGVpZ2h0O1xuICBjb25zdCBsdGFyZ2V0ID0gcGFnZS5nZXRWaWV3QnlJZChcImx0YXJnZXRcIik7XHJcbiAgbHRhcmdldC5oZWlnaHQgPSB3aWR0aDtcclxuICBsdGFyZ2V0LnRyYW5zbGF0ZVkgPSAtbWF4SGVpZ2h0ICogZWxlMlBlcmNlbnQodGFyZ2V0RWxlKTtcclxuXHJcbiAgZm9yKGxldCBpID0gMDsgaSA8IDM2MDsgaSsrKSB7XHJcbiAgICBlbGUucHVzaCgobWF4RWxlKyBtaW5FbGUpLzIpO1xyXG4gICAgcGFnZS5nZXRWaWV3QnlJZChcImxcIitpKS5oZWlnaHQgPSBtYXhIZWlnaHQgKiBlbGUyUGVyY2VudChlbGVbaV0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUdyYXBoKGF6aW11dGgsIGVsZXZhdGlvbiwgaXNPbikge1xyXG4gIGNvbnN0IGF6ID0gTWF0aC5mbG9vcihhemltdXRoKSArIDE4MDtcclxuICBsYXlvdXQuR3JpZExheW91dC5zZXRDb2x1bW4ocGFnZS5nZXRWaWV3QnlJZChcImxjdXJzb3JcIiksIGF6KTtcclxuICBpZihpc09uKXtcclxuICAgIGVsZVthel0gPSAtZWxldmF0aW9uPG1pbkVsZT8gbWluRWxlOiAtZWxldmF0aW9uPm1heEVsZT8gbWF4RWxlOiAtZWxldmF0aW9uO1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRWaWV3ID0gcGFnZS5nZXRWaWV3QnlJZChcImxcIitheik7XHJcbiAgICBjdXJyZW50Vmlldy5oZWlnaHQgPSBtYXhIZWlnaHQgKiBlbGUyUGVyY2VudChlbGVbYXpdKTtcclxuXHJcbiAgICBjb25zdCBkaWYgPSBhei1wcmV2SW5kZXg7XHJcbiAgICBpZihNYXRoLmFicyhkaWYpID4gMSAmJiBNYXRoLmFicyhkaWYpIDwgc21vb3RoaW5nUmFuZ2UpIHtcclxuICAgICAgbGV0IHN0YXJ0LCBlbmQ7XHJcbiAgICAgIGlmKGRpZiA+IDApIHtcclxuICAgICAgICBzdGFydCA9IHByZXZJbmRleCArIDE7XHJcbiAgICAgICAgZW5kID0gYXo7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3RhcnQgPSBheiArIDE7XHJcbiAgICAgICAgZW5kID0gcHJldkluZGV4O1xyXG4gICAgICB9XHJcbiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XHJcbiAgICAgICAgZWxlW2ldID0gZWxlW3N0YXJ0LTFdICsgKGkgLSBzdGFydCsxKSAvIChkaWYtMSkgKiAoZWxlW2F6XS1lbGVbcHJldkluZGV4XSk7XHJcbiAgICAgICAgcGFnZS5nZXRWaWV3QnlJZChcImxcIisoaSkpLmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVtpXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHByZXZJbmRleCA9IGF6O1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZWxlMlBlcmNlbnQoZWxldmF0aW9uKSB7XHJcbiAgcmV0dXJuIChlbGV2YXRpb24gLSBtaW5FbGUpLyhtYXhFbGUtbWluRWxlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9uRXhpdCgpIHtcclxufVxyXG4iXX0=