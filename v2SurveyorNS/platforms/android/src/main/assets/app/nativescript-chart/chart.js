"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var platform = require("platform");
var layout = require("ui/layouts/grid-layout");
var page;
var ele = [];
var maxEle;
var minEle;
var targetEle;
var prevIndex;
var smoothingRange; // when there is a data skip in the azimuth, we want to smooth it out linearly. This is the max range of the smoothing. Any jumps more than 20 will not be smoothed
var width = platform.screen.mainScreen.widthPixels / 360 / platform.screen.mainScreen.scale; // in dp
var maxHeight = platform.screen.mainScreen.heightPixels / 8 / platform.screen.mainScreen.scale; // in dp
function initGraph(myPage) {
    console.log("Entering initGraph");
    page = myPage;
    maxEle = 60;
    minEle = 0;
    targetEle = 40;
    smoothingRange = 20;
    page.getViewById("graph").height = maxHeight;
    var ltarget = page.getViewById("ltarget");
    ltarget.height = width;
    ltarget.translateY = -maxHeight * ele2Percent(targetEle);
    for (var i = 0; i < 360; i++) {
        ele.push((maxEle + minEle) / 2);
        page.getViewById("l" + i).height = maxHeight * ele2Percent(ele[i]);
    }
}
exports.initGraph = initGraph;
function updateGraph(azimuth, elevation, isOn) {
    var az = Math.floor(azimuth) + 180;
    layout.GridLayout.setColumn(page.getViewById("lcursor"), az);
    if (isOn) {
        ele[az] = -elevation < minEle ? minEle : -elevation > maxEle ? maxEle : -elevation;
        var currentView = page.getViewById("l" + az);
        currentView.height = maxHeight * ele2Percent(ele[az]);
        var dif = az - prevIndex;
        if (Math.abs(dif) > 1 && Math.abs(dif) < smoothingRange) {
            var start = void 0, end = void 0;
            if (dif > 0) {
                start = prevIndex + 1;
                end = az;
            }
            else {
                start = az + 1;
                end = prevIndex;
            }
            for (var i = start; i < end; i++) {
                ele[i] = ele[start - 1] + (i - start + 1) / (dif - 1) * (ele[az] - ele[prevIndex]);
                page.getViewById("l" + (i)).height = maxHeight * ele2Percent(ele[i]);
            }
        }
        prevIndex = az;
    }
}
exports.updateGraph = updateGraph;
function clear() {
    for (var i = 0; i < 360; i++) {
        ele[i] = (maxEle + minEle) / 2;
        page.getViewById("l" + i).height = maxHeight * ele2Percent(ele[i]);
    }
}
exports.clear = clear;
function ele2Percent(elevation) {
    return (elevation - minEle) / (maxEle - minEle);
}
function onExit() {
}
exports.onExit = onExit;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFxQztBQUdyQywrQ0FBaUQ7QUFFakQsSUFBSSxJQUFJLENBQUM7QUFDVCxJQUFNLEdBQUcsR0FBYSxFQUFFLENBQUM7QUFFekIsSUFBSSxNQUFjLENBQUM7QUFDbkIsSUFBSSxNQUFjLENBQUM7QUFDbkIsSUFBSSxTQUFpQixDQUFDO0FBQ3RCLElBQUksU0FBaUIsQ0FBQztBQUN0QixJQUFJLGNBQXNCLENBQUMsQ0FBQyxtS0FBbUs7QUFFL0wsSUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLEdBQUcsR0FBRSxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRO0FBQ3RHLElBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFlBQVksR0FBRyxDQUFDLEdBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUTtBQUV6RyxtQkFBMEIsTUFBTTtJQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDbEMsSUFBSSxHQUFHLE1BQU0sQ0FBQztJQUNkLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDWixNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ1gsU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNmLGNBQWMsR0FBRyxFQUFFLENBQUM7SUFDcEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO0lBQzdDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDNUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDdkIsT0FBTyxDQUFDLFVBQVUsR0FBRyxD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LENBQUMsRUFBRSxFQUFFLENBQUM7UUFDNUIsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFFLE1BQU0sQ0FBQyxHQUFDLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsR0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuRSxDQUFDO0FBQ0gsQ0FBQztBQUxELHNCQUtDO0FBRUQscUJBQXFCLFNBQVM7SUFDNUIsTUFBTSxDQUFDLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxHQUFDLENBQUMsTUFBTSxHQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzlDLENBQUM7QUFFRDtBQUNBLENBQUM7QUFERCx3QkFDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBsYXRmb3JtIGZyb20gXCJwbGF0Zm9ybVwiO1xuaW1wb3J0ICogYXMga25vd25Db2xvcnMgZnJvbSBcImNvbG9yL2tub3duLWNvbG9yc1wiO1xuaW1wb3J0ICogYXMgSW1hZ2VNb2R1bGUgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvaW1hZ2VcIjtcbmltcG9ydCAqIGFzIGxheW91dCBmcm9tIFwidWkvbGF5b3V0cy9ncmlkLWxheW91dFwiO1xuXG5sZXQgcGFnZTtcbmNvbnN0IGVsZTogbnVtYmVyW10gPSBbXTtcblxubGV0IG1heEVsZTogbnVtYmVyO1xubGV0IG1pbkVsZTogbnVtYmVyO1xubGV0IHRhcmdldEVsZTogbnVtYmVyO1xubGV0IHByZXZJbmRleDogbnVtYmVyO1xubGV0IHNtb290aGluZ1JhbmdlOiBudW1iZXI7IC8vIHdoZW4gdGhlcmUgaXMgYSBkYXRhIHNraXAgaW4gdGhlIGF6aW11dGgsIHdlIHdhbnQgdG8gc21vb3RoIGl0IG91dCBsaW5lYXJseS4gVGhpcyBpcyB0aGUgbWF4IHJhbmdlIG9mIHRoZSBzbW9vdGhpbmcuIEFueSBqdW1wcyBtb3JlIHRoYW4gMjAgd2lsbCBub3QgYmUgc21vb3RoZWRcblxuY29uc3Qgd2lkdGggPSBwbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi53aWR0aFBpeGVscyAvIDM2MCAvcGxhdGZvcm0uc2NyZWVuLm1haW5TY3JlZW4uc2NhbGU7IC8vIGluIGRwXG5jb25zdCBtYXhIZWlnaHQgPSBwbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi5oZWlnaHRQaXhlbHMgLyA4IC9wbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi5zY2FsZTsgLy8gaW4gZHBcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRHcmFwaChteVBhZ2UpIHtcbiAgY29uc29sZS5sb2coXCJFbnRlcmluZyBpbml0R3JhcGhcIik7XG4gIHBhZ2UgPSBteVBhZ2U7XG4gIG1heEVsZSA9IDYwO1xuICBtaW5FbGUgPSAwO1xuICB0YXJnZXRFbGUgPSA0MDtcbiAgc21vb3RoaW5nUmFuZ2UgPSAyMDtcbiAgcGFnZS5nZXRWaWV3QnlJZChcImdyYXBoXCIpLmhlaWdodCA9IG1heEhlaWdodDtcbiAgY29uc3QgbHRhcmdldCA9IHBhZ2UuZ2V0Vmlld0J5SWQoXCJsdGFyZ2V0XCIpO1xuICBsdGFyZ2V0LmhlaWdodCA9IHdpZHRoO1xuICBsdGFyZ2V0LnRyYW5zbGF0ZVkgPSAtbWF4SGVpZ2h0ICogZWxlMlBlcmNlbnQodGFyZ2V0RWxlKTtcblxuICBmb3IobGV0IGkgPSAwOyBpIDwgMzYwOyBpKyspIHtcbiAgICBlbGUucHVzaCgobWF4RWxlKyBtaW5FbGUpLzIpO1xuICAgIHBhZ2UuZ2V0Vmlld0J5SWQoXCJsXCIraSkuaGVpZ2h0ID0gbWF4SGVpZ2h0ICogZWxlMlBlcmNlbnQoZWxlW2ldKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlR3JhcGgoYXppbXV0aCwgZWxldmF0aW9uLCBpc09uKSB7XG4gIGNvbnN0IGF6ID0gTWF0aC5mbG9vcihhemltdXRoKSArIDE4MDtcbiAgbGF5b3V0LkdyaWRMYXlvdXQuc2V0Q29sdW1uKHBhZ2UuZ2V0Vmlld0J5SWQoXCJsY3Vyc29yXCIpLCBheik7XG4gIGlmKGlzT24pe1xuICAgIGVsZVthel0gPSAtZWxldmF0aW9uPG1pbkVsZT8gbWluRWxlOiAtZWxldmF0aW9uPm1heEVsZT8gbWF4RWxlOiAtZWxldmF0aW9uO1xuXG4gICAgY29uc3QgY3VycmVudFZpZXcgPSBwYWdlLmdldFZpZXdCeUlkKFwibFwiK2F6KTtcbiAgICBjdXJyZW50Vmlldy5oZWlnaHQgPSBtYXhIZWlnaHQgKiBlbGUyUGVyY2VudChlbGVbYXpdKTtcblxuICAgIGNvbnN0IGRpZiA9IGF6LXByZXZJbmRleDtcbiAgICBpZihNYXRoLmFicyhkaWYpID4gMSAmJiBNYXRoLmFicyhkaWYpIDwgc21vb3RoaW5nUmFuZ2UpIHtcbiAgICAgIGxldCBzdGFydCwgZW5kO1xuICAgICAgaWYoZGlmID4gMCkge1xuICAgICAgICBzdGFydCA9IHByZXZJbmRleCArIDE7XG4gICAgICAgIGVuZCA9IGF6O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RhcnQgPSBheiArIDE7XG4gICAgICAgIGVuZCA9IHByZXZJbmRleDtcbiAgICAgIH1cbiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgIGVsZVtpXSA9IGVsZVtzdGFydC0xXSArIChpIC0gc3RhcnQrMSkgLyAoZGlmLTEpICogKGVsZVthel0tZWxlW3ByZXZJbmRleF0pO1xuICAgICAgICBwYWdlLmdldFZpZXdCeUlkKFwibFwiKyhpKSkuaGVpZ2h0ID0gbWF4SGVpZ2h0ICogZWxlMlBlcmNlbnQoZWxlW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcHJldkluZGV4ID0gYXo7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyKCkge1xuICBmb3IobGV0IGkgPSAwOyBpIDwgMzYwOyBpKyspIHtcbiAgICBlbGVbaV0gPSAobWF4RWxlKyBtaW5FbGUpLzI7XG4gICAgcGFnZS5nZXRWaWV3QnlJZChcImxcIitpKS5oZWlnaHQgPSBtYXhIZWlnaHQgKiBlbGUyUGVyY2VudChlbGVbaV0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVsZTJQZXJjZW50KGVsZXZhdGlvbikge1xuICByZXR1cm4gKGVsZXZhdGlvbiAtIG1pbkVsZSkvKG1heEVsZS1taW5FbGUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb25FeGl0KCkge1xufVxuIl19