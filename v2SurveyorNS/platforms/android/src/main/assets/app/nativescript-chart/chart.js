"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var platform = require("platform");
var layout = require("ui/layouts/grid-layout");
var page;
var ele = [];
var minEle = 0;
var targetEle = 40;
var maxEle = 60;
var prevIndex;
var smoothingRange = 20; // when there is a data skip in the azimuth, we want to smooth it out linearly. This is the max range of the smoothing. Any jumps more than 20 will not be smoothed
var width = platform.screen.mainScreen.widthPixels / 360 / platform.screen.mainScreen.scale; // in dp
var maxHeight = platform.screen.mainScreen.heightPixels / 8 / platform.screen.mainScreen.scale; // in dp
/** Function: initialize the graph with graph height, target line, and default values
 * @param myPage  used to eventually get views by id
 */
function initGraph(myPage) {
    console.log("Entering initGraph");
    page = myPage;
    page.getViewById("graph").height = maxHeight;
    var ltarget = page.getViewById("ltarget");
    ltarget.height = width;
    ltarget.translateY = -maxHeight * ele2Percent(targetEle);
    for (var i = 0; i < 360; i++) {
        ele.push((maxEle + minEle) / 2); // start at 50%
        page.getViewById("l" + i).height = maxHeight * ele2Percent(ele[i]);
    }
}
exports.initGraph = initGraph;
/** Function: update the graph
 * @param azimuth an arbitrary azimuth
 * @param elevation the elevation at that azimuth
 * @param isOn  whether or not the record button is toggled on
 */
function updateGraph(azimuth, elevation, isOn) {
    var az = Math.floor(azimuth) + 180;
    layout.GridLayout.setColumn(page.getViewById("lcursor"), az);
    if (isOn) {
        ele[az] = -elevation < minEle ? minEle : -elevation > maxEle ? maxEle : -elevation;
        var currentView = page.getViewById("l" + az);
        currentView.height = maxHeight * ele2Percent(ele[az]);
        var dif = az - prevIndex;
        if (Math.abs(dif) > 1 && Math.abs(dif) < smoothingRange) {
            var start = void 0, end = void 0;
            if (dif > 0) {
                start = prevIndex + 1;
                end = az;
            }
            else {
                start = az + 1;
                end = prevIndex;
            }
            for (var i = start; i < end; i++) {
                ele[i] = ele[start - 1] + (i - start + 1) / (dif - 1) * (ele[az] - ele[prevIndex]);
                page.getViewById("l" + (i)).height = maxHeight * ele2Percent(ele[i]);
            }
        }
        prevIndex = az;
    }
}
exports.updateGraph = updateGraph;
/* Function: clears the graph, and reset the bars
 */
function clear() {
    for (var i = 0; i < 360; i++) {
        ele[i] = (maxEle + minEle) / 2;
        page.getViewById("l" + i).height = maxHeight * ele2Percent(ele[i]);
    }
}
exports.clear = clear;
/** Function: convert the elevation to the percentage of the maxHeight
 */
function ele2Percent(elevation) {
    return (elevation - minEle) / (maxEle - minEle);
}
/* Function: called when the app exits
 * UNUSED
 */
function onExit() {
}
exports.onExit = onExit;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjaGFydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFxQztBQUNyQywrQ0FBaUQ7QUFFakQsSUFBSSxJQUFJLENBQUM7QUFDVCxJQUFNLEdBQUcsR0FBYSxFQUFFLENBQUM7QUFFekIsSUFBSSxNQUFNLEdBQVcsQ0FBQyxDQUFDO0FBQ3ZCLElBQUksU0FBUyxHQUFXLEVBQUUsQ0FBQztBQUMzQixJQUFJLE1BQU0sR0FBVyxFQUFFLENBQUM7QUFDeEIsSUFBSSxTQUFpQixDQUFDO0FBQ3RCLElBQUksY0FBYyxHQUFXLEVBQUUsQ0FBQyxDQUFDLG1LQUFtSztBQUVwTSxJQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEdBQUcsR0FBRyxHQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLFFBQVE7QUFDdEcsSUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsWUFBWSxHQUFHLENBQUMsR0FBRSxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxRQUFRO0FBRXpHOztHQUVHO0FBQ0gsbUJBQTBCLE1BQU07SUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQ2xDLElBQUksR0FBRyxNQUFNLENBQUM7SUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUM7SUFDN0MsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM1QyxPQUFPLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztJQUN2QixPQUFPLENBQUMsVUFBVSxHQUFHLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUV6RCxHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzVCLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEdBQUUsTUFBTSxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlO1FBQzdDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxTQUFTLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25FLENBQUM7QUFDSCxDQUFDO0FBWkQsOEJBWUM7QUFFRDs7OztHQUlHO0FBQ0gscUJBQTRCLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSTtJQUNsRCxJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUNyQyxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzdELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxDQUFBLENBQUM7UUFDUCxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUMsTUFBTSxHQUFFLE1BQU0sR0FBRSxDQUFDLFNBQVMsR0FBQyxNQUFNLEdBQUUsTUFBTSxHQUFFLENBQUMsU0FBUyxDQUFDO1FBQzNFLElBQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxHQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzdDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RCxJQUFNLEdBQUcsR0FBRyxFQUFFLEdBQUMsU0FBUyxDQUFDO1FBQ3pCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUN2RCxJQUFJLEtBQUssU0FBQSxFQUFFLEdBQUcsU0FBQSxDQUFDO1lBQ2YsRUFBRSxDQUFBLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1gsS0FBSyxHQUFHLFNBQVMsR0FBRyxDQUFDLENBQUM7Z0JBQ3RCLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDWCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sS0FBSyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQ2YsR0FBRyxHQUFHLFNBQVMsQ0FBQztZQUNsQixDQUFDO1lBQ0QsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDakMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUMzRSxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsR0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckUsQ0FBQztRQUNILENBQUM7UUFDRCxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ2pCLENBQUM7QUFDSCxDQUFDO0FBeEJELGtDQXdCQztBQUVEO0dBQ0c7QUFDSDtJQUNFLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDNUIsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFFLE1BQU0sQ0FBQyxHQUFDLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsR0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuRSxDQUFDO0FBQ0gsQ0FBQztBQUxELHNCQUtDO0FBRUQ7R0FDRztBQUNILHFCQUFxQixTQUFTO0lBQzVCLE1BQU0sQ0FBQyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsR0FBQyxDQUFDLE1BQU0sR0FBQyxNQUFNLENBQUMsQ0FBQztBQUM5QyxDQUFDO0FBRUQ7O0dBRUc7QUFDSDtBQUNBLENBQUM7QUFERCx3QkFDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHBsYXRmb3JtIGZyb20gXCJwbGF0Zm9ybVwiO1xyXG5pbXBvcnQgKiBhcyBsYXlvdXQgZnJvbSBcInVpL2xheW91dHMvZ3JpZC1sYXlvdXRcIjtcclxuXHJcbmxldCBwYWdlO1xyXG5jb25zdCBlbGU6IG51bWJlcltdID0gW107XHJcblxyXG5sZXQgbWluRWxlOiBudW1iZXIgPSAwO1xyXG5sZXQgdGFyZ2V0RWxlOiBudW1iZXIgPSA0MDtcclxubGV0IG1heEVsZTogbnVtYmVyID0gNjA7XHJcbmxldCBwcmV2SW5kZXg6IG51bWJlcjtcclxubGV0IHNtb290aGluZ1JhbmdlOiBudW1iZXIgPSAyMDsgLy8gd2hlbiB0aGVyZSBpcyBhIGRhdGEgc2tpcCBpbiB0aGUgYXppbXV0aCwgd2Ugd2FudCB0byBzbW9vdGggaXQgb3V0IGxpbmVhcmx5LiBUaGlzIGlzIHRoZSBtYXggcmFuZ2Ugb2YgdGhlIHNtb290aGluZy4gQW55IGp1bXBzIG1vcmUgdGhhbiAyMCB3aWxsIG5vdCBiZSBzbW9vdGhlZFxyXG5cclxuY29uc3Qgd2lkdGggPSBwbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi53aWR0aFBpeGVscyAvIDM2MCAvcGxhdGZvcm0uc2NyZWVuLm1haW5TY3JlZW4uc2NhbGU7IC8vIGluIGRwXHJcbmNvbnN0IG1heEhlaWdodCA9IHBsYXRmb3JtLnNjcmVlbi5tYWluU2NyZWVuLmhlaWdodFBpeGVscyAvIDggL3BsYXRmb3JtLnNjcmVlbi5tYWluU2NyZWVuLnNjYWxlOyAvLyBpbiBkcFxyXG5cclxuLyoqIEZ1bmN0aW9uOiBpbml0aWFsaXplIHRoZSBncmFwaCB3aXRoIGdyYXBoIGhlaWdodCwgdGFyZ2V0IGxpbmUsIGFuZCBkZWZhdWx0IHZhbHVlc1xyXG4gKiBAcGFyYW0gbXlQYWdlICB1c2VkIHRvIGV2ZW50dWFsbHkgZ2V0IHZpZXdzIGJ5IGlkXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaW5pdEdyYXBoKG15UGFnZSkge1xyXG4gIGNvbnNvbGUubG9nKFwiRW50ZXJpbmcgaW5pdEdyYXBoXCIpO1xyXG4gIHBhZ2UgPSBteVBhZ2U7XHJcbiAgcGFnZS5nZXRWaWV3QnlJZChcImdyYXBoXCIpLmhlaWdodCA9IG1heEhlaWdodDtcbiAgY29uc3QgbHRhcmdldCA9IHBhZ2UuZ2V0Vmlld0J5SWQoXCJsdGFyZ2V0XCIpO1xyXG4gIGx0YXJnZXQuaGVpZ2h0ID0gd2lkdGg7XHJcbiAgbHRhcmdldC50cmFuc2xhdGVZID0gLW1heEhlaWdodCAqIGVsZTJQZXJjZW50KHRhcmdldEVsZSk7XHJcblxyXG4gIGZvcihsZXQgaSA9IDA7IGkgPCAzNjA7IGkrKykge1xyXG4gICAgZWxlLnB1c2goKG1heEVsZSsgbWluRWxlKS8yKTsgLy8gc3RhcnQgYXQgNTAlXHJcbiAgICBwYWdlLmdldFZpZXdCeUlkKFwibFwiK2kpLmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVtpXSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKiogRnVuY3Rpb246IHVwZGF0ZSB0aGUgZ3JhcGhcclxuICogQHBhcmFtIGF6aW11dGggYW4gYXJiaXRyYXJ5IGF6aW11dGhcclxuICogQHBhcmFtIGVsZXZhdGlvbiB0aGUgZWxldmF0aW9uIGF0IHRoYXQgYXppbXV0aFxyXG4gKiBAcGFyYW0gaXNPbiAgd2hldGhlciBvciBub3QgdGhlIHJlY29yZCBidXR0b24gaXMgdG9nZ2xlZCBvblxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUdyYXBoKGF6aW11dGgsIGVsZXZhdGlvbiwgaXNPbikge1xyXG4gIGNvbnN0IGF6ID0gTWF0aC5mbG9vcihhemltdXRoKSArIDE4MDtcclxuICBsYXlvdXQuR3JpZExheW91dC5zZXRDb2x1bW4ocGFnZS5nZXRWaWV3QnlJZChcImxjdXJzb3JcIiksIGF6KTtcclxuICBpZihpc09uKXtcclxuICAgIGVsZVthel0gPSAtZWxldmF0aW9uPG1pbkVsZT8gbWluRWxlOiAtZWxldmF0aW9uPm1heEVsZT8gbWF4RWxlOiAtZWxldmF0aW9uO1xyXG4gICAgY29uc3QgY3VycmVudFZpZXcgPSBwYWdlLmdldFZpZXdCeUlkKFwibFwiK2F6KTtcclxuICAgIGN1cnJlbnRWaWV3LmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVthel0pO1xyXG4gICAgY29uc3QgZGlmID0gYXotcHJldkluZGV4O1xyXG4gICAgaWYoTWF0aC5hYnMoZGlmKSA+IDEgJiYgTWF0aC5hYnMoZGlmKSA8IHNtb290aGluZ1JhbmdlKSB7IC8vIHRoZSBzbW9vdGhpbmcgcmFuZ2VcclxuICAgICAgbGV0IHN0YXJ0LCBlbmQ7XHJcbiAgICAgIGlmKGRpZiA+IDApIHtcclxuICAgICAgICBzdGFydCA9IHByZXZJbmRleCArIDE7XHJcbiAgICAgICAgZW5kID0gYXo7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgc3RhcnQgPSBheiArIDE7XHJcbiAgICAgICAgZW5kID0gcHJldkluZGV4O1xyXG4gICAgICB9XHJcbiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XHJcbiAgICAgICAgZWxlW2ldID0gZWxlW3N0YXJ0LTFdICsgKGkgLSBzdGFydCsxKSAvIChkaWYtMSkgKiAoZWxlW2F6XS1lbGVbcHJldkluZGV4XSk7XHJcbiAgICAgICAgcGFnZS5nZXRWaWV3QnlJZChcImxcIisoaSkpLmhlaWdodCA9IG1heEhlaWdodCAqIGVsZTJQZXJjZW50KGVsZVtpXSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHByZXZJbmRleCA9IGF6O1xyXG4gIH1cclxufVxyXG5cclxuLyogRnVuY3Rpb246IGNsZWFycyB0aGUgZ3JhcGgsIGFuZCByZXNldCB0aGUgYmFyc1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyKCkge1xyXG4gIGZvcihsZXQgaSA9IDA7IGkgPCAzNjA7IGkrKykge1xyXG4gICAgZWxlW2ldID0gKG1heEVsZSsgbWluRWxlKS8yO1xyXG4gICAgcGFnZS5nZXRWaWV3QnlJZChcImxcIitpKS5oZWlnaHQgPSBtYXhIZWlnaHQgKiBlbGUyUGVyY2VudChlbGVbaV0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqIEZ1bmN0aW9uOiBjb252ZXJ0IHRoZSBlbGV2YXRpb24gdG8gdGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIG1heEhlaWdodFxyXG4gKi9cclxuZnVuY3Rpb24gZWxlMlBlcmNlbnQoZWxldmF0aW9uKSB7XHJcbiAgcmV0dXJuIChlbGV2YXRpb24gLSBtaW5FbGUpLyhtYXhFbGUtbWluRWxlKTtcclxufVxyXG5cclxuLyogRnVuY3Rpb246IGNhbGxlZCB3aGVuIHRoZSBhcHAgZXhpdHNcclxuICogVU5VU0VEXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gb25FeGl0KCkge1xyXG59XHJcbiJdfQ==