"use strict";
/*
In NativeScript, a file with the same name as an XML file is known as
a code-behind file. The code-behind is a great place to place your view
logic, and to set up your pageâ€™s data binding.
*/
Object.defineProperty(exports, "__esModule", { value: true });
var cameraPreview = require("./nativescript-camera-preview/nativescript-camera-preview");
var rotVector = require("./nativescript-rotation-vector/index");
var app = require("application");
var platform = require("platform");
var orientation = require("nativescript-screen-orientation");
var params = require("./nativescript-fov/nativescript-fov");
var permissions = require("nativescript-permissions");
var charts = require("./nativescript-chart/chart");
var instructions = require("./nativescript-instructions/instructions");
var enums_1 = require("ui/enums");
var sat = require("satellite.js/dist/satellite.min.js");
var crosshair;
var doubleline;
var upperText;
var lowerText;
var capturebtn;
var clearbtn;
var recordstop;
var x, y, z;
var page;
var isOn = false;
var isFirst = true;
var timer = 100;
// let filters;
var OUTER_CIRCLE_DIAMETER = 2;
var ANGLE_BETWEEN_LINES = 10;
var yTranslate = app.ios ? -20 : 0;
// Function: resizes the necessary graphics at startup
var resize = function () {
    console.log("sat is ");
    console.dir(sat.satellite);
    var scaleCrosshair = params.degrees2Scale(OUTER_CIRCLE_DIAMETER, crosshair.getMeasuredHeight());
    crosshair.scaleX = scaleCrosshair;
    crosshair.scaleY = scaleCrosshair;
    crosshair.translateY = yTranslate;
    var scaleDoubleLine = params.degrees2Scale(ANGLE_BETWEEN_LINES, doubleline.getMeasuredHeight());
    doubleline.scaleX = scaleDoubleLine;
    doubleline.scaleY = scaleDoubleLine;
    var cameraView = page.getViewById("placeholder-view");
    cameraView.animate({
        scale: {
            x: platform.screen.mainScreen.heightPixels / cameraView.getMeasuredHeight(),
            y: platform.screen.mainScreen.heightPixels / cameraView.getMeasuredHeight()
        },
        translate: {
            x: 0,
            y: app.ios ? -10 : 0
        },
        duration: 200
    });
};
// Function: the update that animates all the graphics
var updateCallback = function () {
    charts.updateGraph(x, y, isOn);
    instructions.trigger2(y);
    instructions.trigger4(x);
    if (isFirst) {
        resize();
        isFirst = false;
    }
    crosshair.rotate = -z;
    var distanceFromCenter = params.pixels2Dp((params.degrees2Pixels((-y % ANGLE_BETWEEN_LINES)
        - ANGLE_BETWEEN_LINES / 2 * (y > 0 ? -1 : 1))));
    doubleline.translateX = Math.sin(z * Math.PI / 180) * distanceFromCenter;
    doubleline.translateY = Math.cos(z * Math.PI / 180) * distanceFromCenter + yTranslate;
    doubleline.rotate = -z;
    var dist = params.degrees2Scale(ANGLE_BETWEEN_LINES, doubleline.getMeasuredHeight()) * params.degrees2Pixels(ANGLE_BETWEEN_LINES / 2);
    lowerText.text = 10 * Math.floor(-y / 10);
    lowerText.translateX = Math.sin(z * Math.PI / 180) * ((app.ios ? 20 : 0) + distanceFromCenter + dist);
    lowerText.translateY = Math.cos(z * Math.PI / 180) * ((app.ios ? 20 : 0) + distanceFromCenter + dist) + yTranslate;
    lowerText.rotate = -z;
    upperText.text = 10 * Math.floor((-y + 10) / 10);
    upperText.translateX = Math.sin(z * Math.PI / 180) * ((app.ios ? -20 : 0) + distanceFromCenter - dist);
    upperText.translateY = Math.cos(z * Math.PI / 180) * ((app.ios ? -20 : 0) + distanceFromCenter - dist) + yTranslate;
    upperText.rotate = -z;
};
// Function: updates the x/y/z values from the rotation callback
var rotationCallback = function (data) {
    x = data.x;
    y = data.y;
    z = data.z;
    if (app.ios)
        updateCallback(); // ios doesn't seem to expose a callback for every frame update in the camera preview; therefore, we'll hop on the rotation callback
};
// Function: sets the pap to be fullscreen and orientation to be always portrait
function onLoaded(args) {
    orientation.setCurrentOrientation("portrait", function () { });
    if (app.android && platform.device.sdkVersion >= '21') {
        var View = android.view.View;
        var window_1 = app.android.startActivity.getWindow();
        // set the status bar to Color.Transparent
        // window.setStatusBarColor(0x000000);
        var decorView = window_1.getDecorView();
        decorView.setSystemUiVisibility(View.SYSTEM_UI_FLAG_LAYOUT_STABLE
            | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
            | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
            | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION // hide nav bar
            | View.SYSTEM_UI_FLAG_FULLSCREEN // hide status bar
            | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);
    }
    cameraPreview.onLoaded(args, "placeholder-view");
}
exports.onLoaded = onLoaded;
// Function: creates the graph, instructions, view, permissions, FOV when initializing placeholder
function onCreatingView(args) {
    charts.initGraph(page);
    instructions.trigger1(page);
    if (app.android) {
        permissions.requestPermission(android["Manifest"].permission.CAMERA, "I need these permissions for the viewfinder")
            .then(function () {
            console.log("Woo Hoo, I have the power!");
        })
            .catch(function () {
            console.log("Uh oh, no permissions - plan B time!");
        });
    }
    if (app.android)
        params.initialize();
    cameraPreview.onCreatingView(updateCallback, args);
    if (app.ios !== undefined)
        params.initialize();
    rotVector.startRotUpdates(rotationCallback, { sensorDelay: "game" });
    var maxSize = cameraPreview.getMaxSize();
    params.setVars(maxSize[0], maxSize[1]);
}
exports.onCreatingView = onCreatingView;
// Function: When the record button is pressed
function onTakeShot(args) {
    cameraPreview.onTakeShot(args);
    instructions.trigger3(x);
    isOn = !isOn;
    capturebtn.animate({
        scale: { x: 1.2, y: 1.2 },
        duration: 100
    }).then(function () {
        capturebtn.animate({
            scale: { x: 1, y: 1 },
            duration: 300,
            curve: enums_1.AnimationCurve.spring
        });
        recordstop.src = isOn ? "res://stop" : "res://record";
    });
    console.log("el: " + y);
}
exports.onTakeShot = onTakeShot;
// Function: when the clear button is pressed (for charts)
function onClear(args) {
    charts.clear();
    clearbtn.animate({
        scale: { x: 1.2, y: 1.2 },
        duration: 100
    }).then(function () {
        clearbtn.animate({
            scale: { x: 1, y: 1 },
            duration: 300,
            curve: enums_1.AnimationCurve.spring
        });
    });
}
exports.onClear = onClear;
// Function: sets the view variables from the page
function navigatingTo(args) {
    page = args.object;
    crosshair = page.getViewById("crosshair");
    doubleline = page.getViewById("doubleline");
    upperText = page.getViewById("upperText");
    lowerText = page.getViewById("lowerText");
    capturebtn = page.getViewById("capturebtn");
    clearbtn = page.getViewById("clearbtn");
    recordstop = page.getViewById("recordstop");
}
exports.navigatingTo = navigatingTo;
// Function: Resumes the app
app.on(app.resumeEvent, function (args) {
    rotVector.startRotUpdates(rotationCallback, { sensorDelay: "game" });
    cameraPreview.onResume();
});
// Function: Pauses the app
app.on(app.suspendEvent, function (args) {
    cameraPreview.onPause();
    rotVector.stopRotUpdates();
    charts.onExit();
});
// Function: when the app exits
// UNUSED
app.on(app.exitEvent, function (args) {
    console.log("On Exitting");
    rotVector.stopRotUpdates();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi1wYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7OztFQUlFOztBQUlGLHlGQUEyRjtBQUMzRixnRUFBa0U7QUFDbEUsaUNBQW1DO0FBQ25DLG1DQUFxQztBQUNyQyw2REFBK0Q7QUFDL0QsNERBQThEO0FBQzlELHNEQUF3RDtBQUN4RCxtREFBcUQ7QUFDckQsdUVBQXlFO0FBQ3pFLGtDQUF3QztBQUN4Qyx3REFBMEQ7QUFFMUQsSUFBSSxTQUFjLENBQUM7QUFDbkIsSUFBSSxVQUFlLENBQUM7QUFDcEIsSUFBSSxTQUFjLENBQUM7QUFDbkIsSUFBSSxTQUFjLENBQUM7QUFDbkIsSUFBSSxVQUFlLENBQUM7QUFDcEIsSUFBSSxRQUFhLENBQUM7QUFDbEIsSUFBSSxVQUFlLENBQUM7QUFDcEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNaLElBQUksSUFBSSxDQUFDO0FBQ1QsSUFBSSxJQUFJLEdBQVksS0FBSyxDQUFDO0FBQzFCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQztBQUNuQixJQUFJLEtBQUssR0FBVyxHQUFHLENBQUM7QUFDeEIsZUFBZTtBQUVmLElBQU0scUJBQXFCLEdBQUcsQ0FBQyxDQUFDO0FBQ2hDLElBQU0sbUJBQW1CLEdBQUcsRUFBRSxDQUFDO0FBQy9CLElBQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBRXBDLHNEQUFzRDtBQUN0RCxJQUFNLE1BQU0sR0FBRztJQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDM0IsSUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxTQUFTLENBQUMsaUJBQWlCLEVBQUUs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IE5hdGl2ZVNjcmlwdCwgYSBmaWxlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBhbiBYTUwgZmlsZSBpcyBrbm93biBhc1xyXG5hIGNvZGUtYmVoaW5kIGZpbGUuIFRoZSBjb2RlLWJlaGluZCBpcyBhIGdyZWF0IHBsYWNlIHRvIHBsYWNlIHlvdXIgdmlld1xyXG5sb2dpYywgYW5kIHRvIHNldCB1cCB5b3VyIHBhZ2XigJlzIGRhdGEgYmluZGluZy5cclxuKi9cclxuXHJcbmltcG9ydCB7IEV2ZW50RGF0YSB9IGZyb20gJ2RhdGEvb2JzZXJ2YWJsZSc7XHJcbmltcG9ydCB7IFBhZ2UgfSBmcm9tICd1aS9wYWdlJztcclxuaW1wb3J0ICogYXMgY2FtZXJhUHJldmlldyBmcm9tICcuL25hdGl2ZXNjcmlwdC1jYW1lcmEtcHJldmlldy9uYXRpdmVzY3JpcHQtY2FtZXJhLXByZXZpZXcnO1xyXG5pbXBvcnQgKiBhcyByb3RWZWN0b3IgZnJvbSBcIi4vbmF0aXZlc2NyaXB0LXJvdGF0aW9uLXZlY3Rvci9pbmRleFwiO1xyXG5pbXBvcnQgKiBhcyBhcHAgZnJvbSBcImFwcGxpY2F0aW9uXCI7XHJcbmltcG9ydCAqIGFzIHBsYXRmb3JtIGZyb20gXCJwbGF0Zm9ybVwiO1xyXG5pbXBvcnQgKiBhcyBvcmllbnRhdGlvbiBmcm9tIFwibmF0aXZlc2NyaXB0LXNjcmVlbi1vcmllbnRhdGlvblwiO1xyXG5pbXBvcnQgKiBhcyBwYXJhbXMgZnJvbSBcIi4vbmF0aXZlc2NyaXB0LWZvdi9uYXRpdmVzY3JpcHQtZm92XCI7XHJcbmltcG9ydCAqIGFzIHBlcm1pc3Npb25zIGZyb20gXCJuYXRpdmVzY3JpcHQtcGVybWlzc2lvbnNcIjtcclxuaW1wb3J0ICogYXMgY2hhcnRzIGZyb20gXCIuL25hdGl2ZXNjcmlwdC1jaGFydC9jaGFydFwiO1xyXG5pbXBvcnQgKiBhcyBpbnN0cnVjdGlvbnMgZnJvbSBcIi4vbmF0aXZlc2NyaXB0LWluc3RydWN0aW9ucy9pbnN0cnVjdGlvbnNcIjtcclxuaW1wb3J0IHtBbmltYXRpb25DdXJ2ZX0gZnJvbSBcInVpL2VudW1zXCI7XHJcbmltcG9ydCAqIGFzIHNhdCBmcm9tIFwic2F0ZWxsaXRlLmpzL2Rpc3Qvc2F0ZWxsaXRlLm1pbi5qc1wiO1xyXG5cclxubGV0IGNyb3NzaGFpcjogYW55O1xyXG5sZXQgZG91YmxlbGluZTogYW55O1xyXG5sZXQgdXBwZXJUZXh0OiBhbnk7XHJcbmxldCBsb3dlclRleHQ6IGFueTtcclxubGV0IGNhcHR1cmVidG46IGFueTtcclxubGV0IGNsZWFyYnRuOiBhbnk7XHJcbmxldCByZWNvcmRzdG9wOiBhbnk7XHJcbmxldCB4LCB5LCB6O1xyXG5sZXQgcGFnZTtcclxubGV0IGlzT246IGJvb2xlYW4gPSBmYWxzZTtcclxubGV0IGlzRmlyc3QgPSB0cnVlO1xyXG5sZXQgdGltZXI6IG51bWJlciA9IDEwMDtcclxuLy8gbGV0IGZpbHRlcnM7XHJcblxyXG5jb25zdCBPVVRFUl9DSVJDTEVfRElBTUVURVIgPSAyO1xyXG5jb25zdCBBTkdMRV9CRVRXRUVOX0xJTkVTID0gMTA7XHJcbmNvbnN0IHlUcmFuc2xhdGUgPSBhcHAuaW9zPyAtMjAgOiAwO1xyXG5cclxuLy8gRnVuY3Rpb246IHJlc2l6ZXMgdGhlIG5lY2Vzc2FyeSBncmFwaGljcyBhdCBzdGFydHVwXHJcbmNvbnN0IHJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xyXG4gIGNvbnNvbGUubG9nKFwic2F0IGlzIFwiKTtcclxuICBjb25zb2xlLmRpcihzYXQuc2F0ZWxsaXRlKTtcclxuICBjb25zdCBzY2FsZUNyb3NzaGFpciA9IHBhcmFtcy5kZWdyZWVzMlNjYWxlKE9VVEVSX0NJUkNMRV9ESUFNRVRFUiwgY3Jvc3NoYWlyLmdldE1lYXN1cmVkSGVpZ2h0KCkpO1xyXG4gIGNyb3NzaGFpci5zY2FsZVggPSBzY2FsZUNyb3NzaGFpcjtcclxuICBjcm9zc2hhaXIuc2NhbGVZID0gc2NhbGVDcm9zc2hhaXI7XHJcbiAgY3Jvc3NoYWlyLnRyYW5zbGF0ZVkgPSB5VHJhbnNsYXRlO1xyXG5cclxuICBjb25zdCBzY2FsZURvdWJsZUxpbmUgPSBwYXJhbXMuZGVncmVlczJTY2FsZShBTkdMRV9CRVRXRUVOX0xJTkVTLCBkb3VibGVsaW5lLmdldE1lYXN1cmVkSGVpZ2h0KCkpO1xyXG4gIGRvdWJsZWxpbmUuc2NhbGVYID0gc2NhbGVEb3VibGVMaW5lO1xyXG4gIGRvdWJsZWxpbmUuc2NhbGVZID0gc2NhbGVEb3VibGVMaW5lO1xyXG5cclxuICBsZXQgY2FtZXJhVmlldyA9IHBhZ2UuZ2V0Vmlld0J5SWQoXCJwbGFjZWhvbGRlci12aWV3XCIpO1xyXG4gIGNhbWVyYVZpZXcuYW5pbWF0ZSh7XHJcbiAgICBzY2FsZToge1xyXG4gICAgICB4OiBwbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi5oZWlnaHRQaXhlbHMvY2FtZXJhVmlldy5nZXRNZWFzdXJlZEhlaWdodCgpLFxyXG4gICAgICB5OiBwbGF0Zm9ybS5zY3JlZW4ubWFpblNjcmVlbi5oZWlnaHRQaXhlbHMvY2FtZXJhVmlldy5nZXRNZWFzdXJlZEhlaWdodCgpXHJcbiAgICB9LFxyXG4gICAgdHJhbnNsYXRlOiB7XHJcbiAgICAgIHg6IDAsXHJcbiAgICAgIHk6IGFwcC5pb3M/IC0xMCA6IDBcclxuICAgIH0sXHJcbiAgICBkdXJhdGlvbjogMjAwXHJcbiAgfSk7XHJcblxyXG59O1xyXG5cclxuLy8gRnVuY3Rpb246IHRoZSB1cGRhdGUgdGhhdCBhbmltYXRlcyBhbGwgdGhlIGdyYXBoaWNzXHJcbmNvbnN0IHVwZGF0ZUNhbGxiYWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgY2hhcnRzLnVwZGF0ZUdyYXBoKHgseSwgaXNPbik7XHJcbiAgaW5zdHJ1Y3Rpb25zLnRyaWdnZXIyKHkpO1xyXG4gIGluc3RydWN0aW9ucy50cmlnZ2VyNCh4KTtcclxuICBpZihpc0ZpcnN0KSB7XHJcbiAgICByZXNpemUoKTtcclxuICAgIGlzRmlyc3QgPSBmYWxzZTtcclxuICB9XHJcbiAgY3Jvc3NoYWlyLnJvdGF0ZSA9IC16O1xyXG4gIGNvbnN0IGRpc3RhbmNlRnJvbUNlbnRlciA9IHBhcmFtcy5waXhlbHMyRHAoKHBhcmFtcy5kZWdyZWVzMlBpeGVscygoLXkgJSBBTkdMRV9CRVRXRUVOX0xJTkVTKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBBTkdMRV9CRVRXRUVOX0xJTkVTLzIgKiAoeT4wPyAtMTogMSkpKSk7XHJcbiAgZG91YmxlbGluZS50cmFuc2xhdGVYID0gTWF0aC5zaW4oeipNYXRoLlBJLzE4MCkqZGlzdGFuY2VGcm9tQ2VudGVyO1xyXG4gIGRvdWJsZWxpbmUudHJhbnNsYXRlWSA9ICBNYXRoLmNvcyh6Kk1hdGguUEkvMTgwKSpkaXN0YW5jZUZyb21DZW50ZXIgKyB5VHJhbnNsYXRlO1xyXG4gIGRvdWJsZWxpbmUucm90YXRlID0gLXo7XHJcblxyXG4gIGNvbnN0IGRpc3QgPSBwYXJhbXMuZGVncmVlczJTY2FsZShBTkdMRV9CRVRXRUVOX0xJTkVTLCBkb3VibGVsaW5lLmdldE1lYXN1cmVkSGVpZ2h0KCkpKnBhcmFtcy5kZWdyZWVzMlBpeGVscyhBTkdMRV9CRVRXRUVOX0xJTkVTLzIpO1xyXG5cclxuICBsb3dlclRleHQudGV4dCA9IDEwKiBNYXRoLmZsb29yKC15LzEwKTtcclxuICBsb3dlclRleHQudHJhbnNsYXRlWCA9IE1hdGguc2luKHogKiBNYXRoLlBJLzE4MCkqICgoYXBwLmlvcz8gMjA6IDApICsgZGlzdGFuY2VGcm9tQ2VudGVyICsgZGlzdCk7XHJcbiAgbG93ZXJUZXh0LnRyYW5zbGF0ZVkgPSBNYXRoLmNvcyh6ICogTWF0aC5QSS8xODApKiAoKGFwcC5pb3M/IDIwOiAwKSArIGRpc3RhbmNlRnJvbUNlbnRlciArIGRpc3QpICsgeVRyYW5zbGF0ZTtcclxuICBsb3dlclRleHQucm90YXRlID0gLXo7XHJcblxyXG4gIHVwcGVyVGV4dC50ZXh0ID0gMTAqIE1hdGguZmxvb3IoKC15ICsgMTApLzEwKTtcclxuICB1cHBlclRleHQudHJhbnNsYXRlWCA9IE1hdGguc2luKHogKiBNYXRoLlBJLzE4MCkqICgoYXBwLmlvcz8gLTIwOiAwKSArIGRpc3RhbmNlRnJvbUNlbnRlciAtIGRpc3QpO1xyXG4gIHVwcGVyVGV4dC50cmFuc2xhdGVZID0gTWF0aC5jb3MoeiAqIE1hdGguUEkvMTgwKSogKChhcHAuaW9zPyAtMjA6IDApICsgZGlzdGFuY2VGcm9tQ2VudGVyIC0gZGlzdCkgKyB5VHJhbnNsYXRlO1xyXG4gIHVwcGVyVGV4dC5yb3RhdGUgPSAtejtcclxufTtcclxuXHJcbi8vIEZ1bmN0aW9uOiB1cGRhdGVzIHRoZSB4L3kveiB2YWx1ZXMgZnJvbSB0aGUgcm90YXRpb24gY2FsbGJhY2tcclxuY29uc3Qgcm90YXRpb25DYWxsYmFjayA9IGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgIHggPSBkYXRhLng7XHJcbiAgICB5ID0gZGF0YS55O1xyXG4gICAgeiA9IGRhdGEuejtcclxuICAgIGlmKGFwcC5pb3MpIHVwZGF0ZUNhbGxiYWNrKCk7IC8vIGlvcyBkb2Vzbid0IHNlZW0gdG8gZXhwb3NlIGEgY2FsbGJhY2sgZm9yIGV2ZXJ5IGZyYW1lIHVwZGF0ZSBpbiB0aGUgY2FtZXJhIHByZXZpZXc7IHRoZXJlZm9yZSwgd2UnbGwgaG9wIG9uIHRoZSByb3RhdGlvbiBjYWxsYmFja1xyXG59O1xyXG5cclxuLy8gRnVuY3Rpb246IHNldHMgdGhlIHBhcCB0byBiZSBmdWxsc2NyZWVuIGFuZCBvcmllbnRhdGlvbiB0byBiZSBhbHdheXMgcG9ydHJhaXRcclxuZXhwb3J0IGZ1bmN0aW9uIG9uTG9hZGVkKGFyZ3M6IEV2ZW50RGF0YSkge1xyXG4gIG9yaWVudGF0aW9uLnNldEN1cnJlbnRPcmllbnRhdGlvbihcInBvcnRyYWl0XCIsICgpID0+IHt9KTtcclxuICBpZiAoYXBwLmFuZHJvaWQgJiYgcGxhdGZvcm0uZGV2aWNlLnNka1ZlcnNpb24gPj0gJzIxJykge1xyXG4gICAgICBjb25zdCBWaWV3IDphbnkgPSBhbmRyb2lkLnZpZXcuVmlldztcclxuICAgICAgY29uc3Qgd2luZG93ID0gYXBwLmFuZHJvaWQuc3RhcnRBY3Rpdml0eS5nZXRXaW5kb3coKTtcclxuICAgICAgLy8gc2V0IHRoZSBzdGF0dXMgYmFyIHRvIENvbG9yLlRyYW5zcGFyZW50XHJcbiAgICAgIC8vIHdpbmRvdy5zZXRTdGF0dXNCYXJDb2xvcigweDAwMDAwMCk7XHJcbiAgICAgIGNvbnN0IGRlY29yVmlldyA9IHdpbmRvdy5nZXREZWNvclZpZXcoKTtcclxuICAgICAgZGVjb3JWaWV3LnNldFN5c3RlbVVpVmlzaWJpbGl0eShcclxuICAgICAgICAgIFZpZXcuU1lTVEVNX1VJX0ZMQUdfTEFZT1VUX1NUQUJMRVxyXG4gICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0xBWU9VVF9ISURFX05BVklHQVRJT05cclxuICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19MQVlPVVRfRlVMTFNDUkVFTlxyXG4gICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0hJREVfTkFWSUdBVElPTiAvLyBoaWRlIG5hdiBiYXJcclxuICAgICAgICAgIHwgVmlldy5TWVNURU1fVUlfRkxBR19GVUxMU0NSRUVOIC8vIGhpZGUgc3RhdHVzIGJhclxyXG4gICAgICAgICAgfCBWaWV3LlNZU1RFTV9VSV9GTEFHX0lNTUVSU0lWRV9TVElDS1kpO1xyXG4gIH1cclxuICBjYW1lcmFQcmV2aWV3Lm9uTG9hZGVkKGFyZ3MsIFwicGxhY2Vob2xkZXItdmlld1wiKTtcclxufVxyXG5cclxuLy8gRnVuY3Rpb246IGNyZWF0ZXMgdGhlIGdyYXBoLCBpbnN0cnVjdGlvbnMsIHZpZXcsIHBlcm1pc3Npb25zLCBGT1Ygd2hlbiBpbml0aWFsaXppbmcgcGxhY2Vob2xkZXJcclxuZXhwb3J0IGZ1bmN0aW9uIG9uQ3JlYXRpbmdWaWV3KGFyZ3M6IEV2ZW50RGF0YSkge1xyXG4gIGNoYXJ0cy5pbml0R3JhcGgocGFnZSk7XHJcbiAgaW5zdHJ1Y3Rpb25zLnRyaWdnZXIxKHBhZ2UpO1xyXG4gIGlmKGFwcC5hbmRyb2lkKSB7XHJcbiAgICBwZXJtaXNzaW9ucy5yZXF1ZXN0UGVybWlzc2lvbihhbmRyb2lkW1wiTWFuaWZlc3RcIl0ucGVybWlzc2lvbi5DQU1FUkEsIFwiSSBuZWVkIHRoZXNlIHBlcm1pc3Npb25zIGZvciB0aGUgdmlld2ZpbmRlclwiKVxyXG4gICAgLnRoZW4oZnVuY3Rpb24oKSB7XHJcbiAgICAgICBjb25zb2xlLmxvZyhcIldvbyBIb28sIEkgaGF2ZSB0aGUgcG93ZXIhXCIpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChmdW5jdGlvbigpIHtcclxuICAgICAgIGNvbnNvbGUubG9nKFwiVWggb2gsIG5vIHBlcm1pc3Npb25zIC0gcGxhbiBCIHRpbWUhXCIpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGlmKGFwcC5hbmRyb2lkKSBwYXJhbXMuaW5pdGlhbGl6ZSgpO1xyXG4gIGNhbWVyYVByZXZpZXcub25DcmVhdGluZ1ZpZXcodXBkYXRlQ2FsbGJhY2ssIGFyZ3MpO1xyXG4gIGlmIChhcHAuaW9zICE9PSB1bmRlZmluZWQpIHBhcmFtcy5pbml0aWFsaXplKCk7XHJcbiAgcm90VmVjdG9yLnN0YXJ0Um90VXBkYXRlcyhyb3RhdGlvbkNhbGxiYWNrLCAgeyBzZW5zb3JEZWxheTogXCJnYW1lXCIgfSk7XHJcbiAgY29uc3QgbWF4U2l6ZSA9IGNhbWVyYVByZXZpZXcuZ2V0TWF4U2l6ZSgpO1xyXG4gIHBhcmFtcy5zZXRWYXJzKG1heFNpemVbMF0sIG1heFNpemVbMV0pO1xyXG59XHJcblxyXG4vLyBGdW5jdGlvbjogV2hlbiB0aGUgcmVjb3JkIGJ1dHRvbiBpcyBwcmVzc2VkXHJcbmV4cG9ydCBmdW5jdGlvbiBvblRha2VTaG90KGFyZ3M6IEV2ZW50RGF0YSkge1xyXG4gIGNhbWVyYVByZXZpZXcub25UYWtlU2hvdChhcmdzKTtcclxuICBpbnN0cnVjdGlvbnMudHJpZ2dlcjMoeCk7XHJcbiAgaXNPbiA9ICFpc09uO1xyXG5cclxuICBjYXB0dXJlYnRuLmFuaW1hdGUoe1xyXG4gICAgc2NhbGU6IHsgeDogMS4yLCB5OiAxLjIgfSxcclxuICAgIGR1cmF0aW9uOiAxMDBcclxuICB9KS50aGVuKCgpPT4ge1xyXG4gICAgY2FwdHVyZWJ0bi5hbmltYXRlKFxyXG4gICAgICB7XHJcbiAgICAgICAgc2NhbGU6IHsgeDogMSwgeTogMX0sXHJcbiAgICAgICAgZHVyYXRpb246IDMwMCxcclxuICAgICAgICBjdXJ2ZTogQW5pbWF0aW9uQ3VydmUuc3ByaW5nXHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgICByZWNvcmRzdG9wLnNyYyA9IGlzT24/IFwicmVzOi8vc3RvcFwiIDogXCJyZXM6Ly9yZWNvcmRcIjtcclxuICB9KTtcclxuICBjb25zb2xlLmxvZyhcImVsOiBcIiArIHkpO1xyXG59XHJcblxyXG4vLyBGdW5jdGlvbjogd2hlbiB0aGUgY2xlYXIgYnV0dG9uIGlzIHByZXNzZWQgKGZvciBjaGFydHMpXHJcbmV4cG9ydCBmdW5jdGlvbiBvbkNsZWFyKGFyZ3M6IEV2ZW50RGF0YSkge1xyXG4gIGNoYXJ0cy5jbGVhcigpO1xyXG4gIGNsZWFyYnRuLmFuaW1hdGUoe1xyXG4gICAgc2NhbGU6IHsgeDogMS4yLCB5OiAxLjIgfSxcclxuICAgIGR1cmF0aW9uOiAxMDBcclxuICB9KS50aGVuKCgpPT4ge1xyXG4gICAgY2xlYXJidG4uYW5pbWF0ZSh7XHJcbiAgICAgICAgc2NhbGU6IHsgeDogMSwgeTogMX0sXHJcbiAgICAgICAgZHVyYXRpb246IDMwMCxcclxuICAgICAgICBjdXJ2ZTogQW5pbWF0aW9uQ3VydmUuc3ByaW5nXHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gRnVuY3Rpb246IHNldHMgdGhlIHZpZXcgdmFyaWFibGVzIGZyb20gdGhlIHBhZ2VcclxuZXhwb3J0IGZ1bmN0aW9uIG5hdmlnYXRpbmdUbyhhcmdzOiBFdmVudERhdGEpIHtcclxuICAgIHBhZ2UgPSA8UGFnZT5hcmdzLm9iamVjdDtcclxuICAgIGNyb3NzaGFpciA9IHBhZ2UuZ2V0Vmlld0J5SWQoXCJjcm9zc2hhaXJcIik7XHJcbiAgICBkb3VibGVsaW5lID0gcGFnZS5nZXRWaWV3QnlJZChcImRvdWJsZWxpbmVcIik7XHJcbiAgICB1cHBlclRleHQgPSBwYWdlLmdldFZpZXdCeUlkKFwidXBwZXJUZXh0XCIpO1xyXG4gICAgbG93ZXJUZXh0ID0gcGFnZS5nZXRWaWV3QnlJZChcImxvd2VyVGV4dFwiKTtcclxuICAgIGNhcHR1cmVidG4gPSBwYWdlLmdldFZpZXdCeUlkKFwiY2FwdHVyZWJ0blwiKTtcclxuICAgIGNsZWFyYnRuID0gcGFnZS5nZXRWaWV3QnlJZChcImNsZWFyYnRuXCIpO1xyXG4gICAgcmVjb3Jkc3RvcCA9IHBhZ2UuZ2V0Vmlld0J5SWQoXCJyZWNvcmRzdG9wXCIpO1xyXG59XHJcblxyXG4vLyBGdW5jdGlvbjogUmVzdW1lcyB0aGUgYXBwXHJcbmFwcC5vbihhcHAucmVzdW1lRXZlbnQsIGZ1bmN0aW9uKGFyZ3MpIHtcclxuICByb3RWZWN0b3Iuc3RhcnRSb3RVcGRhdGVzKHJvdGF0aW9uQ2FsbGJhY2ssICB7IHNlbnNvckRlbGF5OiBcImdhbWVcIiB9KTtcclxuICBjYW1lcmFQcmV2aWV3Lm9uUmVzdW1lKCk7XHJcbn0pO1xyXG5cclxuLy8gRnVuY3Rpb246IFBhdXNlcyB0aGUgYXBwXHJcbmFwcC5vbihhcHAuc3VzcGVuZEV2ZW50LCBmdW5jdGlvbihhcmdzKSB7XHJcbiAgY2FtZXJhUHJldmlldy5vblBhdXNlKCk7XHJcbiAgcm90VmVjdG9yLnN0b3BSb3RVcGRhdGVzKCk7XHJcbiAgY2hhcnRzLm9uRXhpdCgpO1xyXG59KTtcclxuXHJcbi8vIEZ1bmN0aW9uOiB3aGVuIHRoZSBhcHAgZXhpdHNcclxuLy8gVU5VU0VEXHJcbmFwcC5vbihhcHAuZXhpdEV2ZW50LCBmdW5jdGlvbihhcmdzKSB7XHJcbiAgY29uc29sZS5sb2coXCJPbiBFeGl0dGluZ1wiKTtcclxuICByb3RWZWN0b3Iuc3RvcFJvdFVwZGF0ZXMoKTtcclxufSk7XHJcbiJdfQ==